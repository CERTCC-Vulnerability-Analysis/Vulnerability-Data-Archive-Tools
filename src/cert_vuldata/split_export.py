'''
Created on Apr 1, 2016

@author: adh
'''

import os
from cert_vuldata.json_dump_parser import process_dir, process_raw_data, dump_record, get_vul_outfile, \
    get_vendor_outfile

def _main(args):
    root_path = os.path.expanduser(args.inpath)

    for data in process_dir(os.path.join(root_path, 'CERT_vul_reports.json')):
        for record in process_raw_data(data):
            dump_record(record, get_vul_outfile, args.outpath)

    for data in process_dir(os.path.join(root_path, 'CERT_vendor_records.json')):
        for record in process_raw_data(data):
            dump_record(record, get_vendor_outfile, args.outpath)

def main():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('--inpath', default='./in', help='path to dir where data is stored')
    parser.add_argument('--outpath', default='./out', help='path to dir where data should be output')

    args = parser.parse_args()

    if not os.path.exists(args.inpath):
        print("Cannot find inpath: [{}]".format(args.inpath))
        print()
        print(parser.print_help())
        exit()

    _main(args)

if __name__ == '__main__':
    main()
